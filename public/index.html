<!DOCTYPE html>
<html>
  <head>
    <title>mURL</title>
    <link href="./output.css" rel="stylesheet" />
    <script type="text/javascript" src="https://livejs.com/live.js"></script>
  </head>
  <body class="bg-slate-500">
    <main class="container mx-auto my-4 p-4 bg-slate-300">
      <div class="flex justify-center mb-4">
        <h1 class="text-2xl">Minimal URL</h1>
      </div>

      <div class="grid grid-cols-2 gap-2">
        <p class="text-lg">Enter a URL to shorten:</p>
        <input type="text" id="urlInput" class="text-lg rounded px-2" />

        <p class="text-lg">Customize the short URL (optional):</p>
        <input type="text" id="customInput" class="text-lg rounded px-2" />

        <button
          class="text-lg col-start-2 px-2 bg-slate-200 rounded outline-2 outline-sky-700 hover:outline"
          onclick="shorten()"
        >
          Shorten
        </button>

        <p class="text-lg">Shortened URL:</p>
        <div class="flex gap-2">
          <p id="shortUrl" class="grow text-lg bg-slate-200 rounded px-2"></p>
          <button id="copy" class="text-lg bg-slate-200 px-2 rounded outline-2 outline-sky-700 hover:outline" onclick="copy()">
            Copy
          </button>
        </div>
      </div>
    </main>
    <script defer>
      const shortUrlElem = document.getElementById("shortUrl");
      shortUrlElem.innerText = `${location.href}r/...`;

      function shorten() {
        // Get the input URL and custom short URL (if any)
        var longUrl = document.getElementById("urlInput").value;
        var customUrl = document.getElementById("customInput").value;

        // Make a POST request to the server to create a short URL
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/shorten", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            // Update the UI with the shortened URL
            var shortUrl = JSON.parse(xhr.responseText).shortUrl;
            shortUrlElem.innerText = shortUrl;
          }
        };

        var payload = { longUrl: longUrl };
        if (customUrl) {
          payload.customUrl = customUrl;
        }
        xhr.send(JSON.stringify(payload));
      }

      function copy() {
        var text = shortUrlElem.innerText;
        navigator.clipboard.writeText(text);

				document.getElementById("copy").innerText = "Copied";
				setTimeout(() => (document.getElementById("copy").innerText = "Copy"), 5000)
      }
    </script>
  </body>
</html>
